# includes\12-Malware.ps1
# Malware ï¿½ STUBS ONLY (no working commands included)

function Invoke-Malware {
    param([hashtable]$Config)

    Write-Host "[Malware] Start" -ForegroundColor Cyan

    MLW-Clear-DefenderExclusionPaths      -Config $Config
    MLW-Clear-DefenderExclusionExtensions -Config $Config
    MLW-Run-DefenderScan                  -Config $Config

    Write-Host "[Malware] Done" -ForegroundColor Cyan
}

function MLW-Clear-DefenderExclusionPaths {
<#
.EXPLANATION
Clear all Microsoft Defender exclusion **paths**. Print a simple confirmation when done.

#>
    param([hashtable]$Config)
    $paths = Get-MpPreference | Select-Object -ExpandProperty ExclusionPath
$paths = $paths | Where-Object { $_ -and $_.Trim() -ne "" }
foreach ($p in $paths) {
try { Remove-MpPreference -ExclusionPath $p -ErrorAction SilentlyContinue } catch {}
}
Write-Output "Windows Defender exclusion path cleared"
}

function MLW-Clear-DefenderExclusionExtensions {
<#
.EXPLANATION
Clear all Microsoft Defender exclusion **file extensions**. Print a simple confirmation when done.

#>
    param([hashtable]$Config)
   $exts = Get-MpPreference | Select-Object -ExpandProperty ExclusionExtension
$exts = $exts | Where-Object { $_ -and $_.Trim() -ne "" }
foreach ($e in $exts) {
try { Remove-MpPreference -ExclusionExtension $e -ErrorAction SilentlyContinue } catch {}
}
Write-Output "Extension exclusion removed from Windows Defender"
}

function MLW-Run-DefenderScan {
<#
.EXPLANATION
Run a **Quick Scan** with Microsoft Defender, then prompt the user "Would you like to perform a full scan? (y/n)".
If the answer is 'y' (case-insensitive), run a **Full Scan**; otherwise do nothing further.
Show status lines before/after the quick scan and before the full scan if chosen.

#>
    param([hashtable]$Config)
    Write-Output "Performing a Windows Defender Quick Scan..."
Start-MpScan -ScanType QuickScan
Write-Output "Quick Scan Complete."
$response = Read-Host "Would you like to perform a full scan? (y/n)"
if ($response -eq 'y' -or $response -eq 'Y') {
Write-Output "Performing a Windows Defender Full Scan..."
Start-MpScan -ScanType FullScan
}
}